### 集群
* 如果项目跑在一台机器上，这台机器出现故障的话，或者用户请求量比较高，一台机器支撑不住的话。我们的网站可能就访问不了。那怎么解决呢？

* 就需要使用多台机器，部署一样的程序，让几个机器同时的运行我们的网站。那怎么 __分发请求__ 到我们的所有机器上？所以 __负载均衡__ 的概念就出现了。



### 负载均衡
* 负载均衡是指基于反向代理能将现在所有的请求根据指定的策略算法，分发到不同的服务器上。

* 常用实现负载均衡的可以用 _nginx_, _lvs_。但是现在也有个问题，如果负载均衡服务器出现问题了怎么办？所以 __冗余__ 的概念就出现了。


### 冗余#
* 冗余其实就是两个或者多台服务器 一个主服务器，一个从服务器。

* 假设一个主服务器的负载均衡服务器出现了问题，从服务器能够替代主服务器来继续负载均衡。实现的方式就是使用 _keepalive_ 来抢占虚拟主机。


### 分布式
* 分布式其实就是将一个大项目的拆分出来，单独运行。

* TODO: 有点费解？


### mysql 主从
* mysql master 服务器会把 sql 操作日志写入到 bin.log 日志里 slave 服务器会去读 master 的 bin.log 日志，然后执行 sql 语句。

主从有以下几个问题。
1. master 服务器能写又能读，slave 却 __只能读__。

* slave 读取的数据还没有写入，这样该怎么解决呢？
    1. 假如缓存，从缓存中读取。
    2. 强制从 master 读取。
    3. 使用 pxc 集群，任何一个节点都是可读可写的，读写强一致性。


### laravel 如何解决数据不一致 -- sticky
* 在 `config/database.php` mysql 配置块中将 `sticky` 设置为 `true`

* `sticky` 是一个 可选值，它可用于立即读取在当前请求周期内已写入数据库的记录。

* 若 `sticky` 选项被启用，并且当前请求周期内执行过 「写」 操作，那么任何 「读」 操作都将使用 「写」 连接。

* 这样可确保同一个请求周期内写入的数据可以被立即读取到，从而避免主从延迟导致数据不一致的问题。不过是否启用它，取决于应用程序的需求。


### 代码怎么同步到多台服务器上 -- TODO: 需要实践
* laravel 为我们提供了扩展包 `laravel/envoy`，它为定义远程服务器的日常任务，提供了一套简洁、轻量的语法。Blade 风格语法即可实现部署任务的配置、Artisan 命令的执行等。

* `composer global require laravel/envoy`

* Envoy 任务都应在项目根目录下的 `Envoy.blade.php` 中定义。写入一下内容
```sh
@servers(['web-1' => '192.168.1.1', 'web-2' => '192.168.1.2'])

@task('deploy', ['on' => ['web-1', 'web-2']])
    cd site
    git pull origin {{ $branch }}
    composer update
    php artisan migrate
@endtask
```

* 以上代码意思就是在命令行 `envoy run deploy` 时候，我们会 ssh 到会 web-1,web-2 执行
```sh
cd site
git pull origin {{ $branch }}
php artisan migrate
```
