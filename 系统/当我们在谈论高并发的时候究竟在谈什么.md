## 当我们在谈论高并发的时候究竟在谈什么?
* https://segmentfault.com/a/1190000019360335


### 什么是高并发?
* __QPS(Query Per Second)意思为“每秒查询率”__，是一台服务器每秒能够响应的查询次数，是对一个特定的查询服务器在规定时间内所处理流量多少的衡量标准。。


### 高并发究竟是什么?
* __高并发__ 的基本表现为单位时间内系统能够同时处理的请求数

* __高并发__ 的核心是对CPU资源的有效压榨。

* CPU密集型业务 与 IO密集型
    * CPU不是也不应该是系统的瓶颈，__系统的大部分时间的状况__ 都是CPU在等I/O (硬盘/内存/网络) 的读/写操作完成。

* 可是为什么常见cpu占满了内存 网络却很正常的情况？


### 控制变量法
* Client -> 负载均衡(LVS,Nginx) -> 服务器(PHP,GO -- RPC,MQ) -> 缓存层(Redis) -> 持久层(MySQL)

* 要达到高并发，我们需要 __负载均衡、服务层、缓存层、持久层__ 都是高可用、高性能的，甚至在第5步，我们也可以通过 __压缩静态文件、HTTP2推送静态文件、CDN__ 来做优化，这里的每一层我们都可以写几本书来谈优化。


### 再谈并发
* 网络编程模型的演变: Fork进程 -> 进程池、线程池 -> 事件驱动(select,epoll) -> 协程

* __并行__：两个事件同一时刻完成。
* __并发__：两个事件在同一时间段内 __交替发生__,从宏观上看，两个事件都发生了。

* 上下文: 节省上下文切换的时间可有效压榨CPU的利用率
    * CPU上下文
    * 进程上下文
    * 线程上下文
    * 协程上下文


### 回到开始的那个问题
* 内存和网络都很正常，但是CPU利用率却跑满了这是为什么？
    * 典型PHP-FPM的CGI模式，每一个HTTP请求, 在不同的php-fpm进程直接不停的切换切换再切换, 根本上就决定了它在高并发上的灾难性表现


### 性能对比 （Swoole 与 Java）
* TODO： 需要 Docker


### 小结
* 无论用什么编程语言，只要针对CPU利用率做有效的优化(__连接池、守护进程、多线程、协程、select轮询、epoll事件驱动__)，你也能搭建出一个高并发和高性能的系统。
